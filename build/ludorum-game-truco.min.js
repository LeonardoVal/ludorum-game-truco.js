//! ludorum-game-truco 0.0.1

(function(t){"use strict";"function"==typeof define&&define.amd?define(["creatartis-base","sermat","ludorum"],t):"object"==typeof exports&&module.exports?module.exports=t(require("creatartis-base"),require("sermat"),require("ludorum")):this["ludorum-game-truco"]=t(this.base,this.Sermat,this.ludorum)}).call(this,function t(e,r,i){"use strict";var a=e.declare,n=(e.raise,e.raiseIf,e.Iterable,e.iterable,i.Game),s=(i.players.UserInterface,{__package__:"ludorum-game-truco",__name__:"ludorum_game_truco",__init__:t,__dependencies__:[e,r,i],__SERMAT__:{include:[e,i]},ai:{}});var o=s.Truco=a(n,{name:"Truco",constructor:function(t){n.call(this,t)},players:["Hand","Foot"],moves:function(){return null},result:function(){return null},next:function(t,e,r){return null},"static __SERMAT__":{identifier:s.__package__+".Truco",serializer:function(t){return[t.activePlayer()]}}});s.__SERMAT__.include.push(o),r.include(s);var c=s.ai.SubTruco=a(n,{name:"SubTruco",constructor:function(t,e,r){n.call(this,this.players[t.length%2]),this.table=t,this.cardsHand=e,this.cardsFoot=r},players:["Hand","Foot"],moves:function(){var t=this.result()?null:{};if(t){var e="Hand"===this.activePlayer()?this.cardsHand:this.cardsFoot;t[this.activePlayer()]=e.map((t,e)=>e)}return t},__tableResults__:function(){for(var t=[],e=0;e<this.table.length;e+=2)t.push(Math.sign(this.table[e]-this.table[e+1]));return t},result:function(){var t,e=this.__tableResults__();if(2==e.length){if((t=e[0]+e[1])>0)return this.victory("Hand");if(t<0)return this.victory("Foot")}else if(3===e.length){if((t=e[0]+e[1]+e[2])>0||0===t&&e[0]>=0)return this.victory("Hand");if(t<0||0===t&&e[0]<0)return this.victory("Foot")}return null},next:function(t,r,i){e.raiseIf(this.result(),"Game is finished!");var a=i?this:this.clone(),n=this.activePlayer(),s=+t[n],o=a["cards"+n];return e.raiseIf(s<0||s>=o.length,"Invalid move ",s,"at",a,"!"),a.table.push(o[s]),o.splice(s,1),a.activatePlayers(this.opponent()),a},clone:function(){return new this.constructor(this.table.slice(),this.cardsHand.slice(),this.cardsFoot.slice())},identifier:function(){var t=t=>(t-1).toString(36);return this.table.length+this.table.map(t).join("")+this.cardsHand.map(t).join("")+this.cardsFoot.map(t).join("")},"static CARDS":[[],["4♦","4♥","4♠","4♣"],["5♦","5♥","5♠","5♣"],["6♦","6♥","6♠","6♣"],["7♥","7♣"],["A♦","A♥","A♠","A♣"],["B♦","B♥","B♠","B♣"],["C♦","C♥","C♠","C♣"],["1♦","1♥"],["2♦","2♥","2♠","2♣"],["3♦","3♥","3♠","3♣"],["7♦"],["7♠"],["1♣"],["1♠"]],"static enumerateCards":function(){var t=e.Iterable;return t.product.apply(t,t.repeat(t.range(1,14),6).toArray()).filter(function(t){var e=(t=t.map(t=>t.toString(36))).slice(0,3),r=t.slice(3,6),i=t.sort().join("");return e.join("")===e.sort().join("")&&r.join("")===r.sort().join("")&&!/([1235679a])\1{4,}|444+|888+|bb+|cc+|dd+|ee+/.test(i)},function(t){return[t.slice(0,3),t.slice(3,6)]})},"static __SERMAT__":{identifier:s.__package__+".SubTruco",serializer:function(t){return[t.table,t.cardsHand,t.cardsFoot]}}});s.__SERMAT__.include.push(c),r.include(s);var l=s.ai.ChallengedTruco=a(c,{name:"ChallengedTruco",constructor:function(t,e,r,i){c.call(this,t,e,r),this.globalScore=i,this.envidoStack=[],this.trucoStack=[]},players:["Hand","Foot"],moves:function(){var t=c.prototype.moves.call(this);if(t){var e=this.envidoStack[this.envidoStack.length-1],r=this.trucoStack[this.trucoStack.length-1];if(e)switch(t[this.activePlayer()]=[l.CHALLENGES.Quiero,l.CHALLENGES.NoQuiero],e){case l.CHALLENGES.Envido:1===this.envidoStack.length&&Array.prototype.push.apply(t[this.activePlayer()],[l.CHALLENGES.Envido]),Array.prototype.push.apply(t[this.activePlayer()],[l.CHALLENGES.RealEnvido,l.CHALLENGES.FaltaEnvido]);break;case l.CHALLENGES.RealEnvido:Array.prototype.push.apply(t[this.activePlayer()],[l.CHALLENGES.FaltaEnvido])}else if(r)switch(t[this.activePlayer()]=[l.CHALLENGES.Quiero,l.CHALLENGES.NoQuiero],lastRaisedChallenge){case l.CHALLENGES.Truco:Array.prototype.push.apply(t[this.activePlayer()],[l.CHALLENGES.ReTruco]);break;case l.CHALLENGES.ReTruco:Array.prototype.push.apply(t[this.activePlayer()],[l.CHALLENGES.ValeCuatro])}else Array.prototype.push.apply(t[this.activePlayer()],[l.CHALLENGES.Truco]),this.table.length<=1&&Array.prototype.push.apply(t[this.activePlayer()],[l.CHALLENGES.Envido,l.CHALLENGES.RealEnvido,l.CHALLENGES.FaltaEnvido])}return t},result:function(){return c.prototype.result.call(this)},next:function(t,e,r){if(!(+t[this.activePlayer()]>2))return c.prototype.next.call(this,t,e,r);r||this.clone();return null},clone:function(){var t=new this.constructor(this.table.slice(),this.cardsHand.slice(),this.cardsFoot.slice(),this.globalScore);return t.envidoStack=this.envidoStack.slice(),t.trucoStack=this.trucoStack.slice(),t},"static CHALLENGES":{Truco:3,ReTruco:4,ValeCuatro:5,Envido:6,RealEnvido:7,FaltaEnvido:8,Quiero:9,NoQuiero:10},"static __SERMAT__":{identifier:s.__package__+".ChallengedTruco",serializer:function(t){return[t.activePlayer()]}}});return s.__SERMAT__.include.push(l),r.include(s),r.include(s),s});
//# sourceMappingURL=ludorum-game-truco.min.js.map