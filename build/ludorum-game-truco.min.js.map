{"version":3,"sources":["../src/__prologue__.js","../src/common.js","../src/Truco.js","../src/ai/SubTruco.js","../src/ai/ChallengedTruco.js","../src/__epilogue__.js"],"names":["__init__","base","Sermat","ludorum","declare","Game","raise","raiseIf","Iterable","iterable","exports","players","UserInterface","__package__","__name__","__dependencies__","__SERMAT__","include","ai","envidoTotal","cards","a","envido","b","c","Math","max","valor","numA","numB","Truco","name","constructor","activePlayer","call","this","moves","result","next","haps","update","static __SERMAT__","identifier","serializer","obj","push","SubTruco","table","cardsHand","cardsFoot","length","map","_","i","__tableResults__","r","sign","tableResultSum","tableResults","victory","that","clone","move","splice","activatePlayers","opponent","slice","toChar","n","toString","join","static CARDS","static enumerateCards","It","product","apply","repeat","range","toArray","filter","sortedCards","sort","test","ChallengedTruco","globalScore","Hand","Foot","envidoStack","envidoGoing","trucoStack","trucoGoing","canUpChallenge","getEnvidoChallenge","trucoChall","getTrucoChallenge","prototype","CHALLENGES","Quiero","NoQuiero","Array","envidoResponses","trucoResponses","envidoChallenge","envidoStackWorth","ValeCuatro","trucoStackWorth","ReTruco","Envido","RealEnvido","FaltaEnvido","cloned_game","wanted","notWanted","faltaEnvidoScore","envidoChall","possibleMoves","handGlobal","footGlobal","static CHALLENGES"],"mappings":"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","file":"ludorum-game-truco.min.js","sourcesContent":["/** Package wrapper and layout.\n*/\nfunction __init__(base, Sermat, ludorum) { \"use strict\";\n// Import synonyms. ////////////////////////////////////////////////////////////////////////////////\n\tvar declare = base.declare,\n\t\traise = base.raise,\n\t\traiseIf = base.raiseIf,\n\t\tIterable = base.Iterable,\n\t\titerable = base.iterable,\n\t\tGame = ludorum.Game,\n\t\tUserInterface = ludorum.players.UserInterface;\n\n// Library layout. /////////////////////////////////////////////////////////////////////////////////\n\tvar exports = {\n\t\t__package__: 'ludorum-game-truco',\n\t\t__name__: 'ludorum_game_truco',\n\t\t__init__: __init__,\n\t\t__dependencies__: [base, Sermat, ludorum],\n\t\t__SERMAT__: { include: [base, ludorum] },\n\n\t\t/** The `ai` is the namespace used for functions and definitions relating to artificial\n\t\tintelligence.\n\t\t*/\n\t\tai: { }\n\t};\n","/** # Common functions and utilities.\n\nTODO\n*/\n\n/**\n * A card move is represented by an object with a player (who throws the card)\n * and a number, which is the index of the thrown card\n *\n * Note that cards are sorted in ascending order so index is consistent\n */\n\n/**\n * Funcion que recibe por parametro la mano actual de un jugador, y retorna los posibles movimientos.\n */\n\nfunction generateMoves(cards) {\n    var moves = [];\n    for (var i = 0; i < cards.length; i++) {\n        moves.push(i);\n    }\n    return moves;\n}\n\nfunction arrEq(a, b) {\n    if (a === b) return true;\n    if (a == null || b == null) return false;\n    if (a.length != b.length) return false;\n\n    // If you don't care about the order of the elements inside\n    // the array, you should sort both arrays here.\n\n    for (var i = 0; i < a.length; ++i) {\n      if (a[i] !== b[i]) return false;\n    }\n    return true;\n}\n\nfunction envidoTotal(cards) {\n    var a = envido(cards[0], cards[1]);\n    var b = envido(cards[0], cards[2]);\n    var c = envido(cards[1], cards[2]);\n\n    return Math.max(a, b, c);\n}\n\n/**\n * Cada carta se representa con un entero del 0 al 39.\n *\n * Dado que hay 10 cartas de cada palo, y son 4 palos,\n * el palo de una carta n es n mod 4.\n *\n * Su número es n // 4 + 1 (para hacerlo de 1 a 10).\n *\n * PALOS\n * 0 - Espada\n * 1 - Basto\n * 2 - Oro\n * 3 - Copa\n *\n * CARTAS\n * 1..7 - 1..7\n * 8 - 10\n * 9 - 11\n * 10 - 12\n */\n\nfunction envido(a, b) {\n    var valor = (a % 4) == (b % 4) ? 20 : 0;\n    var numA = ~~(a / 4) + 1;\n    var numB = ~~(b / 4) + 1;\n    if (numA < 8) {\n        valor += numA;\n    }\n    if (numB < 8) {\n        valor += numB;\n    }\n    return valor;\n}","/** # Truco base\n\nBase abstract class for implementations of variants of the Truco card game.\n*/\nvar Truco = exports.Truco = declare(Game, {\n\tname: 'Truco',\n\n\t/** TODO\n\t*/\n\tconstructor: function Truco(activePlayer){\n\t\tGame.call(this, activePlayer);\n\t\t// initialization\n\t},\n\n\t/** The players' roles in a Truco match are `\"Hand\"` (_Mano_) and `\"Foot\"` (_Pie_).\n\t*/\n\tplayers: [\"Hand\", \"Foot\"],\n\n\t// ## Game logic ###############################################################################\n\n\t/** TODO\n\t*/\n\tmoves: function moves(){\n\t\treturn null;\n\t},\n\n\t/** TODO\n\t*/\n\tresult: function result() {\n\t\treturn null;\n\t},\n\n\t/** TODO\n\t*/\n\tnext: function next(moves, haps, update) {\n\t\treturn null;\n\t},\n\n\t// ## Utility methods ##########################################################################\n\n\t/** Serialization is used in the `toString()` method, but it is also vital for sending the game\n\tstate across a network or the marshalling between the rendering thread and a webworker.\n\t*/\n\t'static __SERMAT__': {\n\t\tidentifier: exports.__package__ +'.Truco',\n\t\tserializer: function serialize_Mancala(obj) {\n\t\t\treturn [obj.activePlayer()];\n\t\t}\n\t}\n}); // declare Truco.\n\n// ## Truco type initialization ####################################################################\n\n/** Sermat serialization.\n*/\nexports.__SERMAT__.include.push(Truco);\nSermat.include(exports);","/** # SubTruco\n\nSimplified version of the _truco_ subgame of the Truco card game, made to investigate the game.\n*/\n\nvar SubTruco = exports.ai.SubTruco = declare(Game, {\n\tname: 'SubTruco',\n\n\t/** The constructor takes:\n\t+ `table`: An array with the cards on the table,\n\t+ `cardsHand`: An array with the cards on the first player's hand,\n\t+ `cardsFoot`: An array with the cards on the second player's hand.\n\t*/\n\tconstructor: function SubTruco(table, cardsHand, cardsFoot) {\n\t\tGame.call(this, this.players[table.length % 2]);\n\t\tthis.table = table;\n\t\tthis.cardsHand = cardsHand;\n\t\tthis.cardsFoot = cardsFoot;\n\t},\n\n\t/** The players' roles in a Truco match are `\"Hand\"` (_Mano_) and `\"Foot\"` (_Pie_).\n\t*/\n\tplayers: [\"Hand\", \"Foot\"],\n\n\t// ## Game logic ###############################################################################\n\n\t/** A move for `SubTruco` is simply the index for the card to be played in the active player's\n\thand.\n\t*/\n\tmoves: function moves() {\n\t\tvar moves = this.result() ? null : {};\n\t\tif (moves) {\n\t\t\tvar cards = this.activePlayer() === 'Hand' ? this.cardsHand : this.cardsFoot;\n\t\t\tmoves[this.activePlayer()] = cards.map((_, i) => i);\n\t\t}\n\t\treturn moves;\n\t},\n\n\t/** The table results are the matches between the cards of each player in the table.\n\t*/\n\t__tableResults__: function __tableResults__() {\n\t\tvar r = [];\n\t\tfor (var i = 0; i < this.table.length; i += 2) {\n\t\t\tr.push(Math.sign(this.table[i] - this.table[i+1]));\n\t\t}\n\t\treturn r;\n\t},\n\n\t/** The round may end when both players have played two cards, if one player wins both card\n\tmatches or wins one with the other being tied. The round must end when both players have played\n\tall their three cards. If the last card match is tied, the player that won the first card match\n\twins. If all three card matches are tied, the _Hand_ player wins.\n\t*/\n\tresult: function result() {\n\t\tvar tableResults = this.__tableResults__(),\n\t\t\ttableResultSum;\n\t\tif (tableResults.length == 2) {\n\t\t\ttableResultSum = tableResults[0] + tableResults[1];\n\t\t\tif (tableResultSum > 0) {\n\t\t\t\treturn this.victory('Hand');\n\t\t\t} else if (tableResultSum < 0) {\n\t\t\t\treturn this.victory('Foot');\n\t\t\t}\n\t\t} else if (tableResults.length === 3) {\n\t\t\ttableResultSum = tableResults[0] + tableResults[1] + tableResults[2];\n\t\t\tif (tableResultSum > 0 || tableResultSum === 0 && tableResults[0] >= 0) {\n\t\t\t\treturn this.victory('Hand');\n\t\t\t} else if (tableResultSum < 0 || tableResultSum === 0 && tableResults[0] < 0) {\n\t\t\t\treturn this.victory('Foot');\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t},\n\n\t/** TODO\n\t*/\n\tnext: function next(moves, haps, update) {\n\t\tbase.raiseIf(this.result(), \"Game is finished!\");\n\t\tvar that = update ? this : this.clone(),\n\t\t\tactivePlayer = this.activePlayer(),\n\t\t\tmove = +moves[activePlayer],\n\t\t\tcards = that['cards'+ activePlayer];\n\t\tbase.raiseIf(move < 0 || move >= cards.length, 'Invalid move ', move, 'at', that, '!');\n\t\tthat.table.push(cards[move]);\n\t\tcards.splice(move, 1);\n\t\tthat.activatePlayers(this.opponent());\n\t\treturn that;\n\t},\n\n\t// ## Utility methods #########################################################################\n\n\tclone: function clone() {\n\t\treturn new this.constructor(this.table.slice(), this.cardsHand.slice(),\n\t\t\tthis.cardsFoot.slice());\n\t},\n\n\t/** The string `identifier` for a `SubTruco` state always has 7 characters. The first one\n\tindicates the number of cards on the table. Then come the cards on the table, each encoded as\n\ta character (base 36). After that come the cards of the _Hand_ player, and finally the ones of\n\tthe _Foot_ player, both encoded in the same way as the cards on the table.\n\t*/\n\tidentifier: function identifier() {\n\t\tvar toChar = (n) => (n - 1).toString(36);\n\t\treturn this.table.length + this.table.map(toChar).join('') +\n\t\t\tthis.cardsHand.map(toChar).join('') +\n\t\t\tthis.cardsFoot.map(toChar).join('');\n\t},\n\n\t/** For this game suits are relevant only in the case of the sevens and the aces. Hence, cards\n\tare encoded using numbers from 1 to 14. How each number may map to a given card is defined in\n\t`CARDS`. Here the french deck's suits are used instead of the spanish deck's ones (because the\n\tlatter are not supported by Unicode). Spades and clubs are the same, diamonds are used for\n\tgolds and hearts for cups.\n\t*/\n\t'static CARDS': [\n\t\t[],                    //  0: Invalid.\n\t\t['4♦','4♥','4♠','4♣'], //  1: All fours.\n\t\t['5♦','5♥','5♠','5♣'], //  2: All fives.\n\t\t['6♦','6♥','6♠','6♣'], //  3: All sixes.\n\t\t['7♥','7♣'],           //  4: Sevens of hearts (cups) and clubs.\n\t\t['A♦','A♥','A♠','A♣'], //  5: All jacks (10s).\n\t\t['B♦','B♥','B♠','B♣'], //  6: All knights (11s).\n\t\t['C♦','C♥','C♠','C♣'], //  7: All kings (12s).\n\t\t['1♦','1♥'],           //  8: Aces of diamonds (golds) and hearts (cups).\n\t\t['2♦','2♥','2♠','2♣'], //  9: All twos.\n\t\t['3♦','3♥','3♠','3♣'], // 10: All threes.\n\t\t['7♦'],                // 11: Seven of diamonds (golds).\n\t\t['7♠'],                // 12: Seven of spades.\n\t\t['1♣'],                // 13: Ace of clubs.\n\t\t['1♠']                 // 14: Ace of spades.\n\t],\n\n\t/** The `enumerateCards` function returns an iterable of all possible hands for `SubTruco`. The\n\torder of the cards in each players' hand is not relevant. The amount of possible cards is\n\tchecked by means of a regular expression.\n\t*/\n\t'static enumerateCards': function enumerateCards() {\n\t\tvar It = base.Iterable,\n\t\t\tbaseSequence = It.product.apply(It, It.repeat(It.range(1,14), 6).toArray());\n\t\treturn baseSequence.filter(function (cards) {\n\t\t\tcards = cards.map((n) => n.toString(36));\n\t\t\tvar cardsHand = cards.slice(0, 3),\n\t\t\t\tcardsFoot = cards.slice(3, 6),\n\t\t\t\tsortedCards = cards.sort().join(''),\n\t\t\t\tamountsRegExp = /([1235679a])\\1{4,}|444+|888+|bb+|cc+|dd+|ee+/;\n\t\t\treturn cardsHand.join('') === cardsHand.sort().join('') &&\n\t\t\t\tcardsFoot.join('') === cardsFoot.sort().join('') &&\n\t\t\t\t!amountsRegExp.test(sortedCards);\n\t\t}, function (cards) {\n\t\t\treturn [cards.slice(0,3), cards.slice(3,6)];\n\t\t});\n\t},\n\n\t/** Serialization is used in the `toString()` method, but it is also vital for sending the game\n\tstate across a network or the marshalling between the rendering thread and a webworker.\n\t*/\n\t'static __SERMAT__': {\n\t\tidentifier: exports.__package__ +'.SubTruco',\n\t\tserializer: function serialize_SubTruco(obj) {\n\t\t\treturn [obj.table, obj.cardsHand, obj.cardsFoot];\n\t\t}\n\t}\n}); // declare Truco.\n\n// ## SubTruco type initialization #################################################################\n\n/** Sermat serialization.\n*/\nexports.__SERMAT__.include.push(SubTruco);\nSermat.include(exports);","/** # ChallengedTruco\n\nA complete (but of complete information) version of the _truco_ subgame, with challenges.\n*/\nvar ChallengedTruco = exports.ai.ChallengedTruco = declare(SubTruco, {\n\tname: 'ChallengedTruco',\n\n\t/** The constructor takes:\n\t *\n\t * `table`: An array with the cards on the table,\n\t * `cardsHand`: An array with the cards on the first player's hand,\n\t * `cardsFoot`: An array with the cards on the second player's hand.\n\t * `globalScore`: An object with the current score of the players, regarding the global game of 30 points.\n\t */\n\tconstructor: function ChallengedTruco(table, cardsHand, cardsFoot, globalScore) {\n\t\tSubTruco.call(this, table, cardsHand, cardsFoot);\n\n\t\tif (!globalScore) {\n\t\t\tthis.globalScore = {'Hand': 0, 'Foot': 0};\n\t\t} else {\n\t\t\tthis.globalScore = globalScore;\n\t\t}\n\n\t\t // _Envido_ related\n\t\tthis.envidoStack = [];\n\t\tthis.envidoGoing = false; // TODO: Update envidoGoing when a challenge is raised/answered\n\n\t\t// _Truco_ related\n\t\tthis.trucoStack = [];\n\t\tthis.trucoGoing = false; // TODO: Update trucoGoing when a challenge is raised/answered\n\t\tthis.canUpChallenge = null; // A player that can up the challenge later\n\t},\n\n\t/** The players' roles in a ChallengedTruco match are `\"Hand\"` (_Mano_) and `\"Foot\"` (_Pie_).\n\t*/\n\tplayers: [\"Hand\", \"Foot\"],\n\n\t// ## Game logic ###############################################################################\n\n\t/**\n\t * A move in `ChallengedTruco` can be either either a `SubTruco` move or a challenge, as defined\n\t * in 'static CHALLENGES'. If there is a challenge currently proposed the moves are declining or\n\t * accepting said challenge, or in  some cases upping the bet.\n\t */\n\tmoves: function moves() {\n\t\tvar envidoChall = this.getEnvidoChallenge();\n\t\tvar trucoChall = this.getTrucoChallenge();\n\n\t\tvar moves = SubTruco.prototype.moves.call(this);\n\n\t\tif (this.envidoGoing) {\n\t\t\tmoves[this.activePlayer()] = [\n\t\t\t\tChallengedTruco.CHALLENGES.Quiero,\n\t\t\t\tChallengedTruco.CHALLENGES.NoQuiero\n\t\t\t];\n\t\t\tArray.prototype.push.apply(moves[this.activePlayer()], this.envidoResponses());\n\t\t} else if (this.trucoGoing) {\n\t\t\tmoves[this.activePlayer()] = [\n\t\t\t\tChallengedTruco.CHALLENGES.Quiero,\n\t\t\t\tChallengedTruco.CHALLENGES.NoQuiero\n\t\t\t];\n\t\t\tArray.prototype.push.apply(moves[this.activePlayer()], this.trucoResponses());\n\t\t} else {\n\t\t\t// No challenges are in negotiation. Can raise new ones or play normally\n\t\t\tif (this.table.length < 2) {\n\t\t\t\tArray.prototype.push.apply(moves[this.activePlayer()], this.envidoResponses());\n\t\t\t}\n\n\t\t\tif (!trucoChall || this.canUpChallenge === this.activePlayer()) {\n\t\t\t\tArray.prototype.push.apply(moves[this.activePlayer()], this.trucoResponses());\n\t\t\t}\n\t\t}\n\t\treturn moves;\n\t},\n\n\t/** TODO\n\t*/\n\tresult: function result() {\n\t\treturn SubTruco.prototype.result.call(this);\n\t},\n\n\t/** TODO\n\t*/\n\tnext: function next(moves, haps, update) {\n\t\tvar activePlayer = this.activePlayer();\n\t\tvar move = +moves[activePlayer];\n\n\t\tif (move <= 2) {\n\t\t\treturn SubTruco.prototype.next.call(this, moves, haps, update);\n\t\t} else {\n\t\t\tvar that = update ? this : this.clone();\n\t\t\tvar envidoChallenge = that.getEnvidoChallenge();\n\t\t\tvar trucoChall = that.getTrucoChallenge();\n\n\t\t\tswitch (move) {\n\t\t\t\tcase ChallengedTruco.CHALLENGES.Quiero:\n\t\t\t\t\tif (envidoChallenge) {\n\t\t\t\t\t\tvar handEnvido = envidoTotal(that.cardsHand);\n\t\t\t\t\t\tvar footEnvido = envidoTotal(that.cardsFoot);\n\t\t\t\t\t\tvar envidoWinner = handEnvido >= footEnvido ? 'Hand' : 'Foot';\n\t\t\t\t\t\tvar envidoWinPoints = that.envidoStackWorth()[0];\n\t\t\t\t\t\tthat.envidoGoing = false;\n\t\t\t\t\t\t// TODO: (meeting) How are the different ENVIDO scores published\n\t\t\t\t\t\t// in Game.result()?\n\t\t\t\t\t} else if (trucoChall) {\n\t\t\t\t\t\tthat.trucoGoing = false;\n\t\t\t\t\t\tthat.canUpChallenge =\n\t\t\t\t\t\t\ttrucoChall != ChallengedTruco.CHALLENGES.ValeCuatro ? activePlayer : null;\n\t\t\t\t\t} else { /* IMPOSSIBLE */ }\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase ChallengedTruco.CHALLENGES.NoQuiero:\n\t\t\t\t\tif (envidoChallenge) {\n\t\t\t\t\t\tthat.envidoGoing = false;\n\t\t\t\t\t\tvar envidoNotWantedPoints = that.envidoStackWorth()[1];\n\t\t\t\t\t\t// TODO: Assign score to the challenging player, game continues\n\t\t\t\t\t} else if (trucoChall) {\n\t\t\t\t\t\tthat.trucoGoing = false;\n\t\t\t\t\t\tvar challengerScore = that.trucoStackWorth() - 1;\n\t\t\t\t\t\t// TODO: Assign score to the challenging player, game over\n\t\t\t\t\t} else { /* IMPOSSIBLE */ }\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase ChallengedTruco.CHALLENGES.Truco:\n\t\t\t\tcase ChallengedTruco.CHALLENGES.ReTruco:\n\t\t\t\tcase ChallengedTruco.CHALLENGES.ValeCuatro:\n\t\t\t\t\tthat.canUpChallenge = null;\n\t\t\t\t\tthat.trucoGoing = true;\n\t\t\t\t\tthat.trucoStack.push(move);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase ChallengedTruco.CHALLENGES.Envido:\n\t\t\t\tcase ChallengedTruco.CHALLENGES.RealEnvido:\n\t\t\t\tcase ChallengedTruco.CHALLENGES.FaltaEnvido:\n\t\t\t\t\tthat.envidoGoing = true;\n\t\t\t\t\tthat.envidoStack.push(move);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tthat.activatePlayers(this.opponent());\n\t\t\treturn that;\n\t\t}\n\t},\n\n\t// ## Utility methods ##########################################################################\n\n\tclone: function clone() {\n\t\tvar cloned_game = new this.constructor(\n\t\t\tthis.table.slice(),\n\t\t\tthis.cardsHand.slice(),\n\t\t\tthis.cardsFoot.slice(),\n\t\t\tthis.globalScore);\n\n\t\tcloned_game.envidoStack = this.envidoStack.slice();\n\t\tcloned_game.trucoStack = this.trucoStack.slice();\n\n\t\treturn cloned_game;\n\t},\n\n\ttrucoStackWorth: function trucoStackWorth() {\n\t\treturn this.trucoStack.length + 1;\n\t\t// Truco: 2\n\t\t// Truco, ReTruco: 3\n\t\t// TRUCO; ReTruco, ValeCuatro: 4\n\t},\n\n\tgetEnvidoChallenge: function() {\n\t\treturn this.envidoStack[this.envidoStack.length - 1];\n\t},\n\n\tgetTrucoChallenge: function() {\n\t\treturn this.trucoStack[this.trucoStack.length - 1];\n\t},\n\n\t/**\n\t * When envido challenges are called their effect is cumulative. If an _Envido_ is answered to\n\t * with a _Real Envido_ then it is worth 5 (2 + 3) points. Not all sequences are allowed.\n\t * Below is the list of allowed _Envido_ type challenge chains, along with the points given to\n\t * the winner or when it is declined.\n\t *\n\t * E               2/1\n\t * RE              3/1\n\t * FE              x/1\n\t * E, E            4/2\n\t * E, RE           5/2\n\t * E, E, RE        7/4\n\t * E, E, RE, FE    x/7\n\t * E, FE           x/2\n\t * RE, FE          x/3\n\t * E, E, FE        x/4\n\t * E, RE, FE       x/5\n\t */\n\tenvidoStackWorth: function envidoStackWorth() {\n\t\tif (this.envidoStack.length) {\n\t\t\treturn null;\n\t\t}\n\t\tvar wanted = 1;\n\t\tvar notWanted = 0;\n\t\tfor (var i = 0; i < this.envidoStack.length; i++) {\n\t\t\tnotWanted = wanted;\n\t\t\tswitch (this.envidoStack[i]) {\n\t\t\t\tcase ChallengedTruco.CHALLENGES.Envido:\n\t\t\t\t\twanted += 2;\n\t\t\t\t\tbreak;\n\t\t\t\tcase ChallengedTruco.CHALLENGES.RealEnvido:\n\t\t\t\t\tnotWanted = wanted;\n\t\t\t\t\twanted += 3;\n\t\t\t\t\tbreak;\n\t\t\t\tcase ChallengedTruco.CHALLENGES.FaltaEnvido:\n\t\t\t\t\treturn [this.faltaEnvidoScore(), notWanted];\n\t\t\t}\n\t\t}\n\t\treturn [wanted, notWanted];\n\t},\n\n\tenvidoResponses: function envidoResponses() {\n\t\tvar envidoChall = this.getEnvidoChallenge();\n\t\tvar possibleMoves = [];\n\n\t\tif (!envidoChall || envidoChall < ChallengedTruco.CHALLENGES.FaltaEnvido) {\n\t\t\tpossibleMoves.push(ChallengedTruco.CHALLENGES.FaltaEnvido);\n\t\t}\n\n\t\tif (!envidoChall || envidoChall < ChallengedTruco.CHALLENGES.RealEnvido) {\n\t\t\tpossibleMoves.push(ChallengedTruco.CHALLENGES.RealEnvido);\n\t\t}\n\n\t\tif (!envidoChall || envidoChall < ChallengedTruco.CHALLENGES.Envido) {\n\t\t\tpossibleMoves.push(ChallengedTruco.CHALLENGES.Envido);\n\t\t}\n\n\t\tif (envidoChall === ChallengedTruco.CHALLENGES.Envido && this.envidoStack.length === 1) {\n\t\t\tpossibleMoves.push(ChallengedTruco.CHALLENGES.Envido);\n\t\t}\n\n\t\treturn possibleMoves;\n\t},\n\n\ttrucoResponses: function trucoResponses() {\n\t\tvar trucoChall = this.getTrucoChallenge();\n\n\t\tswitch (trucoChall) {\n\t\t\tcase ChallengedTruco.CHALLENGES.Truco:\n\t\t\t\treturn [ChallengedTruco.CHALLENGES.ReTruco];\n\t\t\tcase ChallengedTruco.CHALLENGES.ReTruco:\n\t\t\t\treturn [ChallengedTruco.CHALLENGES.ValeCuatro];\n\t\t\tdefault:\n\t\t\t\treturn [ChallengedTruco.CHALLENGES.Truco];\n\t\t}\n\t},\n\n\t/**\n\t * The _Falta Envido_ challenge depends on the global game status. If both players are in\n\t * _malas_ (up to 15 points each), the player that wins the _Falta Envido_ wins the  global\n\t * game. If at least one player is above 15 points this challenge is worth the amount of points\n\t * necessary for the winning player to win the global game.\n\t */\n\tfaltaEnvidoScore: function faltaEnvidoScore() {\n\t\tvar handGlobal = this.globalScore.Hand;\n\t\tvar footGlobal = this.globalScore.Foot;\n\t\tif (handGlobal <= 15 && footGlobal <= 15) {\n\t\t\tif (this.activePlayer() === 'Hand') {\n\t\t\t\treturn 30 - handGlobal;\n\t\t\t} else {\n\t\t\t\treturn 30 - footGlobal;\n\t\t\t}\n\t\t} else {\n\t\t\treturn 30 - Math.max(handGlobal, footGlobal);\n\t\t}\n\t},\n\n    /**\n\n     */\n\t'static CHALLENGES': {\n\t\t'Truco': 3,\n\t\t'ReTruco': 4,\n\t\t'ValeCuatro': 5,\n\t\t'Envido': 6,\n\t\t'RealEnvido': 7,\n\t\t'FaltaEnvido': 8,\n\t\t'Quiero': 9,\n\t\t'NoQuiero': 10\n\t},\n\n\n\t/** Serialization is used in the `toString()` method, but it is also vital for sending the game\n\tstate across a network or the marshalling between the rendering thread and a webworker.\n\t*/\n\t'static __SERMAT__': {\n\t\tidentifier: exports.__package__ + '.ChallengedTruco',\n\t\tserializer: function serialize_Mancala(obj) {\n\t\t\treturn [obj.activePlayer()];\n\t\t}\n\t}\n}); // declare ChallengedTruco.\n\n// ## ChallengedTruco type initialization ####################################################################\n\n/** Sermat serialization.\n*/\nexports.__SERMAT__.include.push(ChallengedTruco);\nSermat.include(exports);\n","// See __prologue__.js\n\tSermat.include(exports);\n\t\n\treturn exports;\n}\n"]}