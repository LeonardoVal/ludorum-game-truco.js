//! ludorum-game-truco 0.0.1

(function(t){"use strict";this["ludorum-game-truco"]=t(this.base,this.Sermat,this.ludorum)}).call(this,function t(e,i,r){"use strict";var n=e.declare,a=(e.raise,e.raiseIf,e.Iterable,e.iterable,r.Game),o=(r.players.UserInterface,{__package__:"ludorum-game-truco",__name__:"ludorum_game_truco",__init__:t,__dependencies__:[e,i,r],__SERMAT__:{include:[e,r]},ai:{}});function s(t){var e=c(t[0],t[1]),i=c(t[0],t[2]),r=c(t[1],t[2]);return Math.max(e,i,r)}function c(t,e){var i=t%4==e%4?20:0,r=1+~~(t/4),n=1+~~(e/4);return r<8&&(i+=r),n<8&&(i+=n),i}var l=o.Truco=n(a,{name:"Truco",constructor:function(t){a.call(this,t)},players:["Hand","Foot"],moves:function(){return null},result:function(){return null},next:function(t,e,i){return null},"static __SERMAT__":{identifier:o.__package__+".Truco",serializer:function(t){return[t.activePlayer()]}}});o.__SERMAT__.include.push(l),i.include(o);var u=o.ai.SubTruco=n(a,{name:"SubTruco",constructor:function(t,e,i){a.call(this,this.players[t.length%2]),this.table=t,this.cardsHand=e,this.cardsFoot=i},players:["Hand","Foot"],moves:function(){var t=this.result()?null:{};if(t){var e="Hand"===this.activePlayer()?this.cardsHand:this.cardsFoot;t[this.activePlayer()]=e.map((t,e)=>e)}return t},__tableResults__:function(){for(var t=[],e=0;e<this.table.length;e+=2)t.push(Math.sign(this.table[e]-this.table[e+1]));return t},result:function(){var t,e=this.__tableResults__();if(2==e.length){if((t=e[0]+e[1])>0)return this.victory("Hand");if(t<0)return this.victory("Foot")}else if(3===e.length){if((t=e[0]+e[1]+e[2])>0||0===t&&e[0]>=0)return this.victory("Hand");if(t<0||0===t&&e[0]<0)return this.victory("Foot")}return null},next:function(t,i,r){e.raiseIf(this.result(),"Game is finished!");var n=r?this:this.clone(),a=this.activePlayer(),o=+t[a],s=n["cards"+a];return e.raiseIf(o<0||o>=s.length,"Invalid move ",o,"at",n,"!"),n.table.push(s[o]),s.splice(o,1),n.activatePlayers(this.opponent()),n},clone:function(){return new this.constructor(this.table.slice(),this.cardsHand.slice(),this.cardsFoot.slice())},identifier:function(){var t=t=>(t-1).toString(36);return this.table.length+this.table.map(t).join("")+this.cardsHand.map(t).join("")+this.cardsFoot.map(t).join("")},"static CARDS":[[],["4♦","4♥","4♠","4♣"],["5♦","5♥","5♠","5♣"],["6♦","6♥","6♠","6♣"],["7♥","7♣"],["A♦","A♥","A♠","A♣"],["B♦","B♥","B♠","B♣"],["C♦","C♥","C♠","C♣"],["1♦","1♥"],["2♦","2♥","2♠","2♣"],["3♦","3♥","3♠","3♣"],["7♦"],["7♠"],["1♣"],["1♠"]],"static enumerateCards":function(){var t=e.Iterable;return t.product.apply(t,t.repeat(t.range(1,14),6).toArray()).filter(function(t){var e=(t=t.map(t=>t.toString(36))).slice(0,3),i=t.slice(3,6),r=t.sort().join("");return e.join("")===e.sort().join("")&&i.join("")===i.sort().join("")&&!/([1235679a])\1{4,}|444+|888+|bb+|cc+|dd+|ee+/.test(r)},function(t){return[t.slice(0,3),t.slice(3,6)]})},"static __SERMAT__":{identifier:o.__package__+".SubTruco",serializer:function(t){return[t.table,t.cardsHand,t.cardsFoot]}}});o.__SERMAT__.include.push(u),i.include(o);var h=o.ai.ChallengedTruco=n(u,{name:"ChallengedTruco",constructor:function(t,e,i,r){u.call(this,t,e,i),this.globalScore=r,this.envidoStack=[],this.envidoGoing=!1,this.trucoStack=[],this.trucoGoing=!1,this.canUpChallenge=null},players:["Hand","Foot"],moves:function(){this.getEnvidoChallenge();var t=this.getTrucoChallenge(),e=u.prototype.moves.call(this);return this.envidoGoing?(e[this.activePlayer()]=[h.CHALLENGES.Quiero,h.CHALLENGES.NoQuiero],Array.prototype.push.apply(e[this.activePlayer()],this.envidoResponses())):this.trucoGoing?(e[this.activePlayer()]=[h.CHALLENGES.Quiero,h.CHALLENGES.NoQuiero],Array.prototype.push.apply(e[this.activePlayer()],this.trucoResponses())):(this.table.length<2&&Array.prototype.push.apply(e[this.activePlayer()],this.envidoResponses()),t&&this.canUpChallenge!==this.activePlayer()||Array.prototype.push.apply(e[this.activePlayer()],this.trucoResponses())),e},result:function(){return u.prototype.result.call(this)},next:function(t,e,i){var r=this.activePlayer(),n=+t[r];if(n<=2)return u.prototype.next.call(this,t,e,i);var a=i?this:this.clone(),o=a.getEnvidoChallenge(),c=a.getTrucoChallenge();switch(n){case h.CHALLENGES.Quiero:if(o){s(a.cardsHand),s(a.cardsFoot),a.envidoStackWorth()[0];a.envidoGoing=!1}else c&&(a.trucoGoing=!1,a.canUpChallenge=c!=ChallgruengedTruco.CHALLENGES.ValeCuatro?r:null);break;case h.CHALLENGES.NoQuiero:if(o){a.envidoGoing=!1;a.envidoStackWorth()[1]}else if(trucoChallenge){a.trucoGoing=!1;a.trucoStackWorth()}break;case h.CHALLENGES.Truco:case h.CHALLENGES.ReTruco:case h.CHALLENGES.ValeCuatro:a.canUpChallenge=null,a.trucoGoing=!0,a.trucoStack.push(n);break;case h.CHALLENGES.Envido:case h.CHALLENGES.RealEnvido:case h.CHALLENGES.FaltaEnvido:a.envidoGoing=!0,a.envidoStack.push(n)}return null},clone:function(){var t=new this.constructor(this.table.slice(),this.cardsHand.slice(),this.cardsFoot.slice(),this.globalScore);return t.envidoStack=this.envidoStack.slice(),t.trucoStack=this.trucoStack.slice(),t},trucoStackWorth:function(){return this.trucoStack.length+1},getEnvidoChallenge:function(){return this.envidoStack[this.envidoStack.length-1]},getTrucoChallenge:function(){return this.trucoStack[this.trucoStack.length-1]},envidoStackWorth:function(){if(this.envidoStack.length)return null;for(var t=1,e=0,i=0;i<this.envidoStack.length;i++)switch(e=t,this.envidoStack[i]){case h.CHALLENGES.Envido:t+=2;break;case h.CHALLENGES.RealEnvido:e=t,t+=3;break;case h.CHALLENGES.FaltaEnvido:return[this.faltaEnvidoScore(),e]}return[t,e]},envidoResponses:function(){var t=this.getEnvidoChallenge(),e=[];return(!t||t<h.CHALLENGES.FaltaEnvido)&&e.push(h.CHALLENGES.FaltaEnvido),(!t||t<h.CHALLENGES.RealEnvido)&&e.push(h.CHALLENGES.RealEnvido),(!t||t<h.CHALLENGES.Envido)&&e.push(h.CHALLENGES.Envido),t===h.CHALLENGES.Envido&&1===this.envidoStack.length&&e.push(h.CHALLENGES.Envido),e},trucoResponses:function(){switch(this.getTrucoChallenge()){case h.CHALLENGES.Truco:return[h.CHALLENGES.ReTruco];case h.CHALLENGES.ReTruco:return[h.CHALLENGES.ValeCuatro];default:return[h.CHALLENGES.Truco]}},faltaEnvidoScore:function(){var t=this.globalScore[0],e=this.globalScore[1];return t<=15&&e<=15?"Hand"===this.activePlayer()?30-t:30-e:30-Math.max(t,e)},"static CHALLENGES":{Truco:3,ReTruco:4,ValeCuatro:5,Envido:6,RealEnvido:7,FaltaEnvido:8,Quiero:9,NoQuiero:10},"static __SERMAT__":{identifier:o.__package__+".ChallengedTruco",serializer:function(t){return[t.activePlayer()]}}});return o.__SERMAT__.include.push(h),i.include(o),i.include(o),o});
//# sourceMappingURL=ludorum-game-truco-tag.min.js.map